<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO -->
    <title>Compress PDF Online - Target Size & Quality Slider | The Image Toolkit</title>
    <meta name="description" content="Compress PDF files online. Set target file size (e.g. 1MB), use a quality slider, or choose presets. Bulk PDF compressor with secure client-side processing.">
    <meta name="keywords" content="compress pdf, reduce pdf size, target pdf size, pdf slider, online pdf compressor, optimize pdf, shrink pdf, free pdf tool">
    
    <!-- FAVICON -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%234F46E5' rx='20'/><path d='M30 70 L50 30 L70 70' fill='none' stroke='white' stroke-width='8'/></svg>">

    <!-- FONTS & ICONS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- LIBRARIES -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- ADSENSE -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7597066031957006" crossorigin="anonymous"></script>

    <script>
        // Initialize PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <style>
        :root {
            --primary: #4F46E5;
            --bg-body: #F3F4F6;
            --text-main: #1F2937;
            --border: #E5E7EB;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg-body); color: var(--text-main); display: flex; flex-direction: column; min-height: 100vh; }
        a { text-decoration: none; color: inherit; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        /* Header */
        header { background: white; border-bottom: 1px solid var(--border); height: 70px; display: flex; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .nav-wrapper { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .logo { font-weight: 700; font-size: 1.5rem; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .nav-links { display: flex; gap: 30px; }
        .nav-links a { font-weight: 500; font-size: 0.95rem; color: var(--text-main); transition: 0.2s; }
        .nav-links a:hover { color: var(--primary); }
        .mobile-toggle { display: none; font-size: 1.5rem; cursor: pointer; color: var(--text-main); }

        /* Ad Wrapper */
        .ad-wrapper { width: 100%; margin: 20px 0; display: flex; justify-content: center; overflow: hidden; min-height: 90px; background: #fff; border: 1px solid #f0f0f0; border-radius: 8px; align-items: center; }

        /* Workspace */
        .workspace { background: #F9FAFB; padding: 2rem 0; min-height: 60vh; }
        .tool-title { text-align: center; margin-bottom: 1.5rem; }
        .tool-title h1 { font-size: 1.8rem; color: #111827; }
        .tool-title p { color: #6B7280; font-size: 1rem; }

        /* Drop Zone */
        .drop-zone {
            background: white; border: 2px dashed #D1D5DB; border-radius: 12px; padding: 3rem 1rem;
            text-align: center; cursor: pointer; transition: 0.2s; max-width: 800px; margin: 0 auto;
        }
        .drop-zone:hover { border-color: var(--primary); background: #EEF2FF; }
        .btn-upload {
            background: var(--primary); color: white; padding: 1rem 2rem; border-radius: 8px;
            font-weight: 600; font-size: 1.1rem; border: none; cursor: pointer; display: inline-flex;
            align-items: center; gap: 10px; margin-bottom: 1rem;
        }

        /* Editor Container */
        .editor-container {
            display: none; max-width: 1000px; margin: 0 auto; background: white;
            border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow: hidden;
        }
        .editor-grid { display: grid; grid-template-columns: 1.5fr 1fr; min-height: 500px; }

        /* Left Panel */
        .file-list-panel { padding: 2rem; border-right: 1px solid var(--border); background: #fff; display: flex; flex-direction: column; }
        .file-list { flex-grow: 1; overflow-y: auto; max-height: 400px; margin-bottom: 1rem; }
        .file-item {
            display: flex; justify-content: space-between; align-items: center; padding: 12px;
            border: 1px solid var(--border); border-radius: 8px; margin-bottom: 10px;
        }
        .file-meta { display: flex; align-items: center; gap: 10px; }
        .file-icon { font-size: 1.5rem; color: #DC2626; }
        
        .add-more-btn {
            background: #F3F4F6; color: var(--text-main); border: 1px dashed var(--border);
            width: 100%; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: 500;
            display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s;
        }
        .add-more-btn:hover { border-color: var(--primary); color: var(--primary); background: #EEF2FF; }

        /* Right Panel */
        .settings-panel { padding: 2rem; background: #F9FAFB; display: flex; flex-direction: column; }
        
        /* Tabs */
        .mode-tabs { display: flex; gap: 5px; margin-bottom: 1.5rem; background: #E5E7EB; padding: 4px; border-radius: 8px; }
        .mode-tab { flex: 1; text-align: center; padding: 8px; cursor: pointer; border-radius: 6px; font-size: 0.9rem; font-weight: 500; transition: 0.2s; }
        .mode-tab.active { background: white; color: var(--primary); box-shadow: 0 1px 2px rgba(0,0,0,0.1); }

        /* Preset Cards */
        .level-cards { display: flex; flex-direction: column; gap: 10px; }
        .level-card {
            background: white; border: 1px solid var(--border); border-radius: 8px; padding: 15px;
            cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 15px;
        }
        .level-card:hover, .level-card.active { border-color: var(--primary); background: #EEF2FF; }
        .level-card.active { box-shadow: 0 0 0 1px var(--primary); }
        .level-icon { font-size: 1.2rem; color: #4B5563; }
        .level-card.active .level-icon { color: var(--primary); }

        /* Custom & Target Inputs */
        .setting-group { margin-bottom: 1.5rem; }
        .setting-label { font-weight: 600; margin-bottom: 0.5rem; display: block; color: #374151; font-size: 0.9rem; }
        input[type=range] { width: 100%; height: 6px; background: #d1d5db; border-radius: 5px; outline: none; accent-color: var(--primary); }
        
        .input-group { display: flex; gap: 10px; }
        .input-box { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; }

        /* Actions */
        .actions-row { display: flex; gap: 10px; margin-top: auto; }
        .btn-action { flex: 2; padding: 1rem; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem; }
        .btn-reset { flex: 1; background: transparent; color: #EF4444; border: 1px solid #EF4444; border-radius: 8px; font-weight: 600; cursor: pointer; }
        .btn-reset:hover { background: #FEF2F2; }
        .btn-action:disabled { background: #9CA3AF; cursor: not-allowed; }

        /* Footer & Content */
        .content-section { background: white; padding: 4rem 0; border-top: 1px solid var(--border); }
        .sidebar-box { border: 1px solid var(--border); border-radius: 8px; padding: 1.5rem; }
        footer { background: #111827; color: #9CA3AF; padding: 2rem 0; margin-top: auto; text-align: center; }

        @media (max-width: 900px) {
            .editor-grid { grid-template-columns: 1fr; }
            .file-list-panel { border-right: none; border-bottom: 1px solid var(--border); }
        }
        @media (max-width: 768px) {
            .mobile-toggle { display: block; }
            .nav-links { display: none; flex-direction: column; position: absolute; top: 70px; left: 0; width: 100%; background: white; padding: 1rem; border-bottom: 1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
            .nav-links.active { display: flex; }
            .nav-links a { padding: 10px 0; border-bottom: 1px solid #f3f4f6; width: 100%; text-align: center; }
        }
    </style>
</head>
<body>

    <header>
        <div class="container nav-wrapper">
            <a href="index.html" class="logo">
                <i class="fas fa-layer-group"></i> The Image Toolkit
            </a>
            <div class="mobile-toggle" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
            <nav class="nav-links" id="navLinks">
                <a href="index.html">Home</a>
                <a href="index.html#tools">All Tools</a>
                <a href="about.html">About</a>
                <a href="index.html#guides">Guides</a>
            </nav>
        </div>
    </header>

    <!-- AD UNIT 1 -->
    <div class="container">
        <div class="ad-wrapper">
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7597066031957006" data-ad-slot="5194353053" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
    </div>

    <!-- Workspace -->
    <section class="workspace">
        <div class="container">
            <div class="tool-title" id="toolTitle">
                <h1>Compress PDF</h1>
                <p>Reduce the file size of your PDF documents without losing quality.</p>
            </div>

            <!-- Upload State -->
            <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
                <input type="file" id="fileInput" multiple accept=".pdf" style="display:none">
                <div style="font-size: 3rem; color: #E5E7EB; margin-bottom: 1rem;"><i class="fas fa-file-pdf"></i></div>
                <button class="btn-upload">Select PDF Files</button>
                <p>or drop PDFs here</p>
            </div>

            <!-- Editor State -->
            <div class="editor-container" id="editorContainer">
                <div class="editor-grid">
                    <!-- Left: File List -->
                    <div class="file-list-panel">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                            <h3 style="margin:0;">PDFs to Compress</h3>
                            <span id="fileCount" style="color:#6B7280; font-size:0.9rem;">0 files</span>
                        </div>
                        
                        <div id="fileList" class="file-list"></div>
                        
                        <button class="add-more-btn" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-plus"></i> Add More Files
                        </button>
                    </div>

                    <!-- Right: Settings -->
                    <div class="settings-panel">
                        <h3 style="margin-bottom: 1.5rem;">Compression Options</h3>

                        <div class="mode-tabs">
                            <div class="mode-tab active" onclick="setMode('presets')">Presets</div>
                            <div class="mode-tab" onclick="setMode('custom')">Slider</div>
                            <div class="mode-tab" onclick="setMode('target')">Target Size</div>
                        </div>

                        <!-- Mode: Presets -->
                        <div id="presetsMode">
                            <div class="level-cards">
                                <div class="level-card" onclick="selectLevel('extreme', this)">
                                    <i class="fas fa-compress-arrows-alt level-icon"></i>
                                    <div class="level-info">
                                        <h4>Extreme Compression</h4>
                                        <p>Low quality (72 DPI). Maximum reduction.</p>
                                    </div>
                                </div>
                                <div class="level-card active" onclick="selectLevel('recommended', this)">
                                    <i class="fas fa-check-circle level-icon"></i>
                                    <div class="level-info">
                                        <h4>Recommended</h4>
                                        <p>Good quality (150 DPI). Standard.</p>
                                    </div>
                                </div>
                                <div class="level-card" onclick="selectLevel('less', this)">
                                    <i class="fas fa-expand-alt level-icon"></i>
                                    <div class="level-info">
                                        <h4>Less Compression</h4>
                                        <p>High quality (200 DPI). Minimal reduction.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Mode: Custom Slider -->
                        <div id="customMode" style="display: none;">
                            <div class="setting-group">
                                <label class="setting-label">Image Quality: <span id="qualityVal">70</span>%</label>
                                <input type="range" id="qualityRange" min="10" max="100" value="70" oninput="document.getElementById('qualityVal').textContent=this.value">
                                <p style="font-size:0.8rem; color:#6B7280; margin-top:5px;">Controls the clarity of images inside the PDF.</p>
                            </div>
                            <div class="setting-group">
                                <label class="setting-label">Resolution Scale: <span id="scaleVal">1.0</span>x</label>
                                <input type="range" id="scaleRange" min="0.5" max="2.0" step="0.1" value="1.0" oninput="document.getElementById('scaleVal').textContent=this.value">
                                <p style="font-size:0.8rem; color:#6B7280; margin-top:5px;">Lower scale reduces dimensions (e.g. 0.5 is half size).</p>
                            </div>
                        </div>

                        <!-- Mode: Target Size -->
                        <div id="targetMode" style="display: none;">
                            <div class="setting-group">
                                <label class="setting-label">Target File Size</label>
                                <div class="input-group">
                                    <input type="number" id="targetInput" class="input-box" placeholder="e.g. 1">
                                    <select id="unitSelect" class="input-box" style="width:80px;">
                                        <option value="MB">MB</option>
                                        <option value="KB">KB</option>
                                    </select>
                                </div>
                                <p style="font-size:0.8rem; color:#6B7280; margin-top:8px;">We will adjust quality per page to attempt to fit this size.</p>
                            </div>
                        </div>

                        <div class="actions-row">
                            <button class="btn-reset" onclick="resetTool()">Start Over</button>
                            <button class="btn-action" id="processBtn">Compress PDF</button>
                        </div>
                        <div id="statusMsg" style="margin-top: 10px; text-align: center; font-size: 0.9rem; font-weight: 500;"></div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- AD UNIT 2 -->
    <div class="container">
        <div class="ad-wrapper">
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7597066031957006" data-ad-slot="4383834265" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
    </div>

    <!-- Content & Footer -->
    <section class="content-section">
        <div class="container" style="display: grid; grid-template-columns: 2fr 1fr; gap: 3rem;">
            <div>
                <h2 style="margin-bottom: 1rem;">Optimize PDF Files Online</h2>
                <p>The Image Toolkit's PDF Compressor reduces the size of your PDF documents to make them easier to share via email or upload to the web. We use smart rasterization to optimize the internal visual data.</p>
                
                <h3 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">Why use this tool?</h3>
                <ul style="padding-left: 20px; line-height: 1.8; color: #4B5563;">
                    <li><strong>Target Size:</strong> Need a PDF under 2MB? Just set the target and we'll handle the rest.</li>
                    <li><strong>Custom Control:</strong> Use sliders to fine-tune visual quality and resolution.</li>
                    <li><strong>Bulk Processing:</strong> Compress multiple PDFs at once. We'll zip them up for you.</li>
                    <li><strong>Secure:</strong> Files are processed locally using your browser's engine. No sensitive data is stored on our servers.</li>
                </ul>
            </div>
            
            <aside>
                <div class="sidebar-box">
                    <h4 style="margin-bottom: 1rem;">Sponsored</h4>
                    <div style="min-height: 250px;">
                        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7597066031957006" data-ad-slot="7424930571" data-ad-format="auto" data-full-width-responsive="true"></ins>
                        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                    </div>
                </div>
            </aside>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="ad-wrapper" style="background: rgba(255,255,255,0.05); border: none;">
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7597066031957006" data-ad-slot="7424930571" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
            <div class="copyright">&copy; 2025 The Image Toolkit. All rights reserved.</div>
        </div>
    </footer>

    <script>
        // --- Mobile Menu ---
        function toggleMenu() { document.getElementById('navLinks').classList.toggle('active'); }

        // --- Logic ---
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const editorContainer = document.getElementById('editorContainer');
        const fileListEl = document.getElementById('fileList');
        const toolTitle = document.getElementById('toolTitle');
        const processBtn = document.getElementById('processBtn');
        const statusMsg = document.getElementById('statusMsg');
        
        let filesData = [];
        let currentMode = 'presets'; // presets, custom, target
        let selectedPreset = 'recommended';

        // Tabs Logic
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
            // Tab Indices: 0=Presets, 1=Custom, 2=Target
            const idx = mode === 'presets' ? 0 : (mode === 'custom' ? 1 : 2);
            document.querySelectorAll('.mode-tab')[idx].classList.add('active');

            document.getElementById('presetsMode').style.display = mode === 'presets' ? 'block' : 'none';
            document.getElementById('customMode').style.display = mode === 'custom' ? 'block' : 'none';
            document.getElementById('targetMode').style.display = mode === 'target' ? 'block' : 'none';
        }

        // Preset Selector
        function selectLevel(level, card) {
            selectedPreset = level;
            document.querySelectorAll('.level-card').forEach(c => c.classList.remove('active'));
            card.classList.add('active');
        }

        // Reset
        function resetTool() {
            filesData = [];
            fileListEl.innerHTML = '';
            document.getElementById('fileCount').textContent = '0 files';
            editorContainer.style.display = 'none';
            toolTitle.style.display = 'block';
            dropZone.style.display = 'block';
            statusMsg.textContent = '';
            processBtn.disabled = false;
            processBtn.textContent = 'Compress PDF';
        }

        // Upload
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.borderColor = 'var(--primary)'; });
        dropZone.addEventListener('dragleave', () => dropZone.style.borderColor = '#D1D5DB');
        dropZone.addEventListener('drop', (e) => { e.preventDefault(); handleFiles(e.dataTransfer.files); });
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        function handleFiles(files) {
            if (files.length === 0) return;
            const newFiles = Array.from(files);
            filesData = [...filesData, ...newFiles];

            // UI Transition
            dropZone.style.display = 'none';
            toolTitle.style.display = 'none';
            editorContainer.style.display = 'block';

            renderFileList();
        }

        function renderFileList() {
            fileListEl.innerHTML = '';
            document.getElementById('fileCount').textContent = `${filesData.length} files`;
            
            filesData.forEach((file, index) => {
                const div = document.createElement('div');
                div.className = 'file-item';
                div.innerHTML = `
                    <div class="file-meta">
                        <i class="fas fa-file-pdf file-icon"></i>
                        <div>
                            <div style="font-weight:500;">${file.name.substring(0, 20)}...</div>
                            <div style="font-size:0.8rem; color:#6B7280;">${(file.size/1024).toFixed(1)} KB</div>
                        </div>
                    </div>
                    <div id="res-${index}" style="font-size:0.8rem; font-weight:600; color:var(--text-light);">Pending</div>
                `;
                fileListEl.appendChild(div);
            });
        }

        // Processing Logic
        processBtn.addEventListener('click', async () => {
            if (filesData.length === 0) return;
            
            processBtn.disabled = true;
            processBtn.textContent = "Compressing...";
            const zip = new JSZip();
            let processed = 0;

            // Determine Base Settings based on Mode
            let scale = 1.0;
            let quality = 0.7;
            let targetBytes = 0; // 0 means ignored

            if (currentMode === 'presets') {
                if (selectedPreset === 'extreme') { scale = 0.8; quality = 0.3; }
                else if (selectedPreset === 'less') { scale = 1.5; quality = 0.9; }
                else { scale = 1.0; quality = 0.7; } // Recommended
            } else if (currentMode === 'custom') {
                quality = document.getElementById('qualityRange').value / 100;
                scale = parseFloat(document.getElementById('scaleRange').value);
            } else if (currentMode === 'target') {
                const val = parseFloat(document.getElementById('targetInput').value) || 1;
                const unit = document.getElementById('unitSelect').value;
                targetBytes = val * (unit === 'MB' ? 1024 * 1024 : 1024);
            }

            for (let i = 0; i < filesData.length; i++) {
                const file = filesData[i];
                const resEl = document.getElementById(`res-${i}`);
                resEl.innerHTML = '<span style="color:var(--primary)">Processing...</span>';
                
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    const { jsPDF } = window.jspdf;
                    
                    const newPdf = new jsPDF();
                    const pdfWidth = newPdf.internal.pageSize.getWidth();
                    const pdfHeight = newPdf.internal.pageSize.getHeight();

                    // If Target Mode: Calculate rough budget per page
                    let pageBudget = 0;
                    if (targetBytes > 0) {
                        pageBudget = (targetBytes * 0.9) / pdf.numPages; // 90% for images, 10% overhead
                    }

                    for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                        const page = await pdf.getPage(pageNum);
                        
                        // If Target Mode: Dynamically find best quality for this page
                        let currentQ = quality;
                        let currentS = scale;
                        
                        if (targetBytes > 0) {
                            // Start reasonably high
                            currentQ = 0.8;
                            currentS = 1.0;
                        }

                        // Helper to render
                        const renderPage = async (q, s) => {
                            const viewport = page.getViewport({ scale: s });
                            const canvas = document.createElement('canvas');
                            const context = canvas.getContext('2d');
                            canvas.height = viewport.height;
                            canvas.width = viewport.width;
                            await page.render({ canvasContext: context, viewport: viewport }).promise;
                            return canvas.toDataURL('image/jpeg', q);
                        };

                        let imgData = await renderPage(currentQ, currentS);

                        // If Target Mode: Check size and reduce if needed
                        if (targetBytes > 0) {
                            // Rough estimate of base64 size: len * 0.75 bytes
                            while (imgData.length * 0.75 > pageBudget && currentQ > 0.2) {
                                currentQ -= 0.1;
                                if (currentQ < 0.5) currentS = 0.8; // Also scale down if desperate
                                imgData = await renderPage(currentQ, currentS);
                            }
                        }
                        
                        if (pageNum > 1) newPdf.addPage();
                        newPdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
                    }

                    const compressedPdfBlob = newPdf.output('blob');
                    zip.file(`compressed_${file.name}`, compressedPdfBlob);
                    
                    const saved = ((file.size - compressedPdfBlob.size) / file.size * 100).toFixed(0);
                    if(saved > 0) {
                        resEl.innerHTML = `<span style="color:#10B981">-${saved}% (${(compressedPdfBlob.size/1024).toFixed(0)} KB)</span>`;
                    } else {
                        resEl.innerHTML = `<span style="color:orange">Already Small</span>`;
                    }
                    processed++;

                } catch (e) {
                    console.error(e);
                    resEl.innerHTML = '<span style="color:red">Error</span>';
                }
            }

            // Download
            statusMsg.textContent = "Generating Download...";
            if (processed === 1) {
                const content = await zip.file(Object.keys(zip.files)[0]).async("blob");
                saveAs(content, Object.keys(zip.files)[0]);
            } else if (processed > 1) {
                const content = await zip.generateAsync({type:"blob"});
                saveAs(content, "TheImageToolkit_compressed.zip");
            }

            processBtn.disabled = false;
            processBtn.textContent = "Compress Again";
            statusMsg.textContent = "Download Started!";
        });
    </script>
</body>
</html>
